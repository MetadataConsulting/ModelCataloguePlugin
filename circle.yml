machine:
  java:
    version: oraclejdk8

dependencies:
  # override:
  #   - ./setup-frontend.sh
  #   - ./where grailsw run ./grailsw compile --non-interactive --stacktrace
  cache_directories:
    - "ModelCatalogueCorePlugin/node_modules"
    - ModelCatalogueCorePluginTestApp/target/work/plugins
    - ~/.m2
    - ~/.grails/ivy-cache
    - ~/.grails/wrapper
    - ~/.npm
test:
  override:
    - ./catalogue test:
       parallel: true
  post:
    - mkdir -p "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueCorePlugin/reports"
    - mv ModelCatalogueCorePlugin/target/reports/*  "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueCorePlugin/reports" || true
    - mkdir -p "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueCorePlugin/test-reports"
    - mv ModelCatalogueCorePlugin/target/test-reports/*  "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueCorePlugin/test-reports" || true
    - mkdir -p "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueDiscoursePlugin/test-reports"
    - mv ModelCatalogueDiscoursePlugin/target/test-reports/*  "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueDiscoursePlugin/test-reports" || true
    - mkdir -p "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueFormsPlugin/test-reports"
    - mv ModelCatalogueFormsPlugin/target/test-reports/*  "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueFormsPlugin/test-reports" || true
    - mkdir -p "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueGenomicsPlugin/test-reports"
    - mv ModelCatalogueGenomicsPlugin/target/test-reports/*  "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueGenomicsPlugin/test-reports" || true
    - mkdir -p "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueElasticSearchPlugin/test-reports"
    - mv ModelCatalogueElasticSearchPlugin/target/test-reports/*  "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueElasticSearchPlugin/test-reports" || true
    - mkdir -p "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueSpringSecurity2xPlugin/test-reports"
    - mv ModelCatalogueSpringSecurity2xPlugin/target/test-reports/*  "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueSpringSecurity2xPlugin/test-reports" || true
    - mkdir -p "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueCorePluginTestApp/geb-reports"
    - mv ModelCatalogueCorePluginTestApp/target/geb-reports/*  "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueCorePluginTestApp/geb-reports" || true
    - mkdir -p "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueCorePluginTestApp/test-reports"
    - mv ModelCatalogueCorePluginTestApp/target/test-reports/*  "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/ModelCatalogueCorePluginTestApp/test-reports" || true
    # save to $CIRCLE_ARTIFACTS as well as it looks as the way how to ensure the test reports get published
    - mkdir -p "$CIRCLE_ARTIFACTS/$CIRCLE_NODE_INDEX"
    - mv "$CIRCLE_TEST_REPORTS/$CIRCLE_NODE_INDEX/*" "$CIRCLE_ARTIFACTS/$CIRCLE_NODE_INDEX/*"
